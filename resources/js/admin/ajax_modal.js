import AjaxModalOpenCallback from"./ajax_modal_open_callback.js";class FlexAdminModal{init=()=>{this.ajaxSuccessCallback(),this.ajaxErrorCallback(),this.triggerModal(),this.modalClosedCallback()};ajaxSuccessCallback=()=>{var e=this;$(document).ajaxSuccess((function(a,o,n){e.isResponseScript(n)?e.stopAndDebug(a,o,n,null):e.isOpening()&&e.isResponseHtml(n)&&(a.preventDefault(),e.renderModalContent(o.responseText))}))};ajaxErrorCallback=()=>{var e=this;$(document).ajaxError((function(a,o,n,t){"canceled"!=t&&e.isOpening()&&!e.isResponseJson(n)&&(a.preventDefault(),n.iframe&&200==o.status&&"OK"==o.statusText&&o.responseText?e.renderModalContent(o.responseText):e.renderFormContent(o.responseText))}))};triggerModal=()=>{var e=this;$(document).on("click","a[data-modal]",(function(a){a.preventDefault();var o=$(this).attr("href");e.getContentByXhr(o)}))};modalClosedCallback=()=>{$(document).on("hidden.bs.modal",(function(){$("#flexadmin-modal").empty().remove()}))};bsModal=e=>{var a=$("#flexadmin-modal");return a.html(e),new window.bootstrap.Modal(a.find(".modal"),{backdrop:"static",keyboard:!1,focus:!1})};open=e=>{var a=$("<div/>",{id:"flexadmin-modal"});$(document.body).append(a),this.bsModal(e).show()};close=()=>{var e=$("#flexadmin-modal .modal");e.length>0&&window.bootstrap.Modal.getInstance(e).hide()};renderModalContent=e=>{var a=$(e).find(".modal-content").html();if(a){var o=$(e).find(".modal-dialog").attr("class");$("#flexadmin-modal .modal-dialog").addClass(o),$("#flexadmin-modal .modal-content").empty().html(a)}};renderFormContent=e=>{$(".modal-body-container").html(e),$.event.trigger({type:"shown.bs.modal"})};isResponseHtml=e=>e.dataTypes.indexOf("html")>=0;isResponseScript=e=>e.dataTypes.indexOf("script")>=0;isResponseJson=e=>e.dataTypes.indexOf("json")>=0;isOpening=()=>1==$("#flexadmin-modal > .modal").length;getContentByXhr=e=>{var a=this;function o(){$.ajax({global:!1,url:e,method:"GET",cache:!1,success:function(e){a.open(e),a.dissmissModalWithExternalLink(),(new AjaxModalOpenCallback).init()}})}a.isOpening()?(a.close(),setTimeout((function(){o()}),200)):o()};stopAndDebug=(e,a,o,n)=>{e.stopImmediatePropagation(),console.log("===> Server response javascript, all events has been stopped, see details below",e),console.log("XmlHttpRequest Object",a),console.log("XmlHttpRequest Settings",o),null==n?console.log("all good"):console.log("Exception",n)};dissmissModalWithExternalLink=()=>{var e=this;$('a[data-window="dismiss-modal-and-open-link"').on("click",(function(){e.close()}))}}export default FlexAdminModal;